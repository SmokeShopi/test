<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Anime Ultimate Parser</title>
    <style>
        body { background: #050505; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 900px; margin: auto; }
        .panel { background: #111; padding: 20px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input { padding: 12px; border-radius: 8px; border: 1px solid #333; background: #1a1a1a; color: #fff; width: 200px; font-size: 16px; outline: none; }
        input:focus { border-color: #ff4500; }
        button { padding: 12px 24px; border-radius: 8px; border: none; background: #ff4500; color: #fff; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
        .source-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 15px; }
        .src-btn { background: #222; border: 1px solid #333; padding: 8px 12px; font-size: 12px; color: #aaa; cursor: pointer; border-radius: 5px; }
        .src-btn.active { border-color: #ff4500; color: #ff4500; background: rgba(255, 69, 0, 0.1); }
        .player-wrapper { position: relative; padding-bottom: 56.25%; background: #000; border-radius: 15px; overflow: hidden; border: 1px solid #222; }
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .status { margin-top: 10px; font-size: 12px; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color: #ff4500; font-size: 24px;">ANIME PARSER v4</h1>

    <div class="panel">
        <input type="number" id="shikiId" value="5114" placeholder="ID Shikimori">
        <button onclick="load()">СМОТРЕТЬ</button>
        
        <div class="source-grid" id="sourceGrid">
            </div>
    </div>

    <div class="player-wrapper">
        <iframe id="video-frame" src="" allowfullscreen referrerpolicy="no-referrer"></iframe>
    </div>

    <div class="status" id="status-bar">Готов к загрузке</div>
</div>

<script>
    // Список актуальных доменов, вдохновленный предоставленными репозиториями
    const sources = [
        { name: "Kodik Biz", url: "https://kodik.biz/find-player?shikimori_id=" },
        { name: "Kodik Online", url: "https://video.kodik.online/find-player?shikimori_id=" },
        { name: "Kodik API", url: "https://kodikapi.com/find-player?shikimori_id=" },
        { name: "Alloha", url: "https://api.alloha.tv/?shikimori_id=" },
        { name: "Collaps", url: "https://api.collaps.org/embed/shikimori/" }
    ];

    let currentBase = sources[0].url;

    function init() {
        const grid = document.getElementById('sourceGrid');
        sources.forEach((s, i) => {
            const btn = document.createElement('button');
            btn.className = 'src-btn' + (i === 0 ? ' active' : '');
            btn.innerText = s.name;
            btn.onclick = () => {
                currentBase = s.url;
                document.querySelectorAll('.src-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                load();
            };
            grid.appendChild(btn);
        });
        load();
    }

    function load() {
        const id = document.getElementById('shikiId').value;
        const frame = document.getElementById('video-frame');
        const statusBar = document.getElementById('status-bar');
        
        let finalUrl = currentBase + id;
        
        // Добавляем типы только если это Kodik домен
        if (currentBase.includes('kodik')) {
            // В репозитории AnimeParsers часто используют именно такой порядок типов
            finalUrl += "&types=anime-serial,anime";
        }

        frame.src = finalUrl;
        statusBar.innerText = "Загрузка с: " + currentBase;
        console.log("URL:", finalUrl);
    }

    window.onload = init;
</script>

</body>
</html>
