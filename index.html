<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Anime Smart Engine v6</title>
    <style>
        :root { --accent: #ff4500; --bg: #0a0a0a; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #141414; padding: 20px; border-radius: 15px; border: 1px solid #222; max-width: 900px; margin: auto; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #333; background: #1a1a1a; color: #fff; width: 150px; }
        button { padding: 12px 20px; border-radius: 8px; border: none; background: var(--accent); color: #fff; font-weight: bold; cursor: pointer; }
        .sources { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 15px 0; }
        .src-btn { background: #222; border: 1px solid #333; padding: 7px 12px; font-size: 11px; color: #888; cursor: pointer; border-radius: 5px; }
        .src-btn.active { border-color: var(--accent); color: var(--accent); }
        .player-wrap { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 15px; overflow: hidden; border: 1px solid #222; margin-top: 20px; }
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .debug-info { margin-top: 10px; font-size: 11px; color: #444; }
    </style>
</head>
<body>

<div class="card">
    <h1>SMART PLAYER</h1>
    <input type="number" id="shikiId" value="5114">
    <button onclick="load()">СМОТРЕТЬ</button>

    <div class="sources" id="sourceBtns"></div>
    
    <div class="player-wrap">
        <iframe id="ifr" src="" allowfullscreen referrerpolicy="no-referrer"></iframe>
    </div>
    <div class="debug-info" id="dblog"></div>
</div>

<script>
    // Самые надежные форматы ссылок на 2026 год
    const config = [
        { name: "Kodik Biz", base: "https://kodik.biz/find-player?shikimori_id=", type: "kodik" },
        { name: "Kodik VIP", base: "https://kodikapi.com/find-player?shikimori_id=", type: "kodik" },
        { name: "Alloha", base: "https://api.alloha.tv/?shikimori_id=", type: "alloha" },
        { name: "Collaps", base: "https://api.collaps.org/embed/shikimori/", type: "collaps" }
    ];

    let current = 0;

    function render() {
        const div = document.getElementById('sourceBtns');
        div.innerHTML = '';
        config.forEach((s, i) => {
            const b = document.createElement('button');
            b.className = 'src-btn' + (i === current ? ' active' : '');
            b.innerText = s.name;
            b.onclick = () => { current = i; render(); load(); };
            div.appendChild(b);
        });
    }

    function load() {
        const id = document.getElementById('shikiId').value;
        const ifr = document.getElementById('ifr');
        const log = document.getElementById('dblog');
        const s = config[current];
        
        let url = s.base + id;

        // Если Kodik требует токен или выдает дорамы, пробуем чистую ссылку
        // БЕЗ лишних параметров, чтобы избежать 404
        if (s.type === "kodik") {
            // Если Kodik Biz не находит, пробуем добавить типы
            url += "&types=anime-serial,anime";
        }

        ifr.src = url;
        log.innerText = "Current URL: " + url;
    }

    window.onload = () => { render(); load(); };
</script>
</body>
</html>
